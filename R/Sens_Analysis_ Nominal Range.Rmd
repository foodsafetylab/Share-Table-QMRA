---
title: "New Sens"
author: "Gustavo Reyes"
date: "2/2/2021"
output: html_document
---
#Main Ideas of the sens Analysis
The goals of this model is to create a sensitivity analysis that changes based on the inputs. 
The general output for the model will be the mean prevalence of ill students
The inputs of interest and their paths are the following
  1. Student Contamination: 
      - mass_feces_hands: rpert(1,-8,-3,-1,shape = 4) [Input_random]
        97.5th: -1.443
        Median: -3.382
        2.5th:  -6.179726
      - HU_NV_in_Feces : rpert(1,4,8,10,shape = 4) [Input_random]
        97.5th:  9.523563 
        Median:  7.747
        2.5th:   5.397141
      -LogRed: rpert(1,0.17,0.45,6,shape = 4) [Input_random]
        97.5th: 3.473241 
        Median: 1.1279
        2.5th:  0.2295374
      -Pr_WashingHand: .42 Static [Input_random]
      -Pr_Student_iC: 0.04 [Input_Static]
  2. Touching: 
      ntouched fruit: rnorm(round(rnorm(1,3,.5),0)) [Input_Random]
        97.5th: 4
        Median: 3
        2.5th:  2
      -Prevalence: Static 4% 
  3.Tranfer Probabilities: 
    -TrP_H_F<-inv.logit(rnorm(1,-3.86,Res_Trans)) [Input_Random]
        97.5th: 0.5012043
        Median: 0.0206298
        2.5th:  0.0004438392
    -TrP_F_H<-inv.logit(rnorm(1,-2.95,Res_Trans)) [Input_Random]
        97.5th: 0.7135126
        Median: 0.0497069
        2.5th:  0.001098976   
    -TrP_H_S<-inv.logit(rnorm(1,-3.82,Res_Trans)) [Input_Random]
        97.5th: 0.5107151
        Median: 0.0214587
        2.5th:  0.0004619996  
    -TrP_S_H<-inv.logit(rnorm(1,0.11,Res_Trans))[Input_Random]
        97.5th: 0.98147
        Median: 0.5277576
        2.5th:  0.02297
  4. Contamination of Fruit, Right now not in system but I will add here. 
    -Prevalence: rbetagen(1,0.79,1.03,0.0,0.2) [Input_Functions]
        97.5th: 0.1929986
        Median: 0.08123
        2.5th:  0.001825192
    - HuNoV_ContFruit: rlnormTrunc(1,2.38,3.52, 0,6.97)  [Input_Functions]
        97.5th: 6.304337 
        Median: 0.7583
        2.5th:  0.003518262
  5. Washing: Reduction of washing: [Input_Functions]
    - 2 log
  
```{r}
SenstivityDF<-data.frame(
  "Input" = 1:10,
  "Description" = "",
  "MaxOut" = "",
  "MinOut" = "",
  "NominalOut"= "",
  "Index"="",
  stringsAsFactors = FALSE
)
```

###Setting Working Directory
```{r}
setwd("C:/Users/gareyes3/Documents/GitHub/Share-Table-QMRA/R") 
 #setwd("G:/Share Table QMRA/Share-Table-QMRA/R")
```

###Opening Libary and Inputs
```{r}
source("Util_Library.R")
source("Functions_Full_Analysis.R")
```



##Input # 1: mass_feces_hands 
##Treatment #1,2,3 (max,nominal,min)


##Maxuimum Value -1.443 

```{r}
Input_No<-1
TreatmentNo<-1

#Adding it to the DF
SenstivityDF[Input_No,colnames(SenstivityDF)=="Description"]<-"mass_feces_hands"

#Inputs and Source Files


#Inputs
source("New_StudentLoop.R")
source("Input_Static.R")
source("Input_Functions.R")
source("Util_DFFunctions.R")
source("Util_DFWeekCreation.R")
source("Util_Counter&Lists.R")
#Functions
source("Util_Functions.R")
source("Util_CCFunctions2.R")
source("Util_VisualFunctions.R")



```

```{r warning=TRUE}
#Running Loop First:-------------------------------------
start_time<-Sys.time()
source("Main_Loops2.R")
```

```{r}
#Summary DFs for Future-------------------------------------

#Creating Data Frame of Consumed Items for all the products
#Copy of Compiled Data Frame
T1_Original<-bind_rows(List_Sens_Fr)

#Data Frame without repeats and Consumed Items
Treatment1<-Func_Asys_MainDF(SummaryList = List_Sens_Fr,FoodType = "Fruit")
```


```{r}
#Treatment 1

Treatment1_Copy<-Treatment1
#ST_ON_Analysis<-ST_ON_Analysis_Copy
Treatment1<-Func_Asys_ContbyStudent(Treatment1)
#Drop NAs
#ST_ON_Analysis<- ST_ON_Analysis[!is.na(ST_ON_Analysis$Contamination), ]

#Analysis For weekly Dose Response ON

OutputsDRT1<-Func_DR_Main(AnalysisDF = Treatment1, Reps_DR = 100)
df_inf_Week_T1<-OutputsDRT1$df_inf_Week
df_ill_Week_T1<-OutputsDRT1$df_ill_Week

df_ill_Week_T1_Prev<-Func_DF_Prevalence(AnalysisDFCop = Treatment1_Copy, df_Ill_Week = df_ill_Week_T1,Intervention = "T1")

meanT1<-mean(df_ill_Week_T1_Prev$Prev)

SenstivityDF[Input_No,colnames(SenstivityDF)=="MaxOut"]<-meanT1

#Adding Results to the DF. 

```


##Nominal Value

```{r}
Input_No<-1
TreatmentNo<-2
#Adding it to the DF
SenstivityDF[Input_No,colnames(SenstivityDF)=="Description"]<-"mass_feces_hands"

#Inputs and Source Files


#Inputs
source("New_StudentLoop.R")
source("Input_Static.R")
source("Input_Functions.R")
source("Util_DFFunctions.R")
source("Util_DFWeekCreation.R")
source("Util_Counter&Lists.R")
#Functions
source("Util_Functions.R")
source("Util_CCFunctions2.R")
source("Util_VisualFunctions.R")



```

```{r warning=TRUE}
#Running Loop First:
start_time<-Sys.time()
source("Main_Loops2.R")
```

```{r}
#Summary DFs for Future

#Creating Data Frame of Consumed Items for all the products
#Copy of Compiled Data Frame
T2_Original<-bind_rows(List_Sens_Fr)

#Data Frame without repeats and Consumed Items
Treatment2<-Func_Asys_MainDF(SummaryList = List_Sens_Fr,FoodType = "Fruit")
```


```{r}
#Treatment 2
Treatment2_Copy<-Treatment2
#ST_ON_Analysis<-ST_ON_Analysis_Copy
Treatment2<-Func_Asys_ContbyStudent(Treatment2)
#Drop NAs
#ST_ON_Analysis<- ST_ON_Analysis[!is.na(ST_ON_Analysis$Contamination), ]

#Analysis For weekly Dose Response ON

OutputsDRT2<-Func_DR_Main(AnalysisDF = Treatment2, Reps_DR = 100)
df_inf_Week_T2<-OutputsDRT2$df_inf_Week
df_ill_Week_T2<-OutputsDRT2$df_ill_Week

df_ill_Week_T2_Prev<-Func_DF_Prevalence(AnalysisDFCop = Treatment2_Copy, df_Ill_Week = df_ill_Week_T2,Intervention = "T2")

meanT2<-mean(df_ill_Week_T2_Prev$Prev)

SenstivityDF[Input_No,colnames(SenstivityDF)=="NominalOut"]<-meanT2

#Adding Results to the DF. 

```


##Minimum Value


```{r}
Input_No<-1
TreatmentNo<-3
#Adding it to the DF
SenstivityDF[Input_No,colnames(SenstivityDF)=="Description"]<-"mass_feces_hands"

#Inputs and Source Files

#Inputs
source("New_StudentLoop.R")
source("Input_Static.R")
source("Input_Functions.R")
source("Util_DFFunctions.R")
source("Util_DFWeekCreation.R")
source("Util_Counter&Lists.R")
#Functions
source("Util_Functions.R")
source("Util_CCFunctions2.R")
source("Util_VisualFunctions.R")



```

```{r warning=TRUE}
#Running Loop First:
start_time<-Sys.time()
source("Main_Loops2.R")
```

```{r}
#Summary DFs for Future

#Creating Data Frame of Consumed Items for all the products
#Copy of Compiled Data Frame
T3_Original<-bind_rows(List_Sens_Fr)

#Data Frame without repeats and Consumed Items
Treatment3<-Func_Asys_MainDF(SummaryList = List_Sens_Fr,FoodType = "Fruit")
```


```{r}
#Treatment 3
Treatment3_Copy<-Treatment3
#ST_ON_Analysis<-ST_ON_Analysis_Copy
Treatment3<-Func_Asys_ContbyStudent(Treatment3)
#Drop NAs
#ST_ON_Analysis<- ST_ON_Analysis[!is.na(ST_ON_Analysis$Contamination), ]

#Analysis For weekly Dose Response ON

OutputsDRT3<-Func_DR_Main(AnalysisDF = Treatment3, Reps_DR = 100)
df_inf_Week_T3<-OutputsDRT3$df_inf_Week
df_ill_Week_T3<-OutputsDRT3$df_ill_Week

df_ill_Week_T3_Prev<-Func_DF_Prevalence(AnalysisDFCop = Treatment3_Copy, df_Ill_Week = df_ill_Week_T3,Intervention = "T3")

meanT3<-mean(df_ill_Week_T3_Prev$Prev)

SenstivityDF[Input_No,colnames(SenstivityDF)=="MinOut"]<-meanT3

#Adding Results to the DF. 

```

##Wrapping the out

```{r}
SIndexT1_3<-(meanT1-meanT3)/meanT2
SenstivityDF[Input_No,colnames(SenstivityDF)=="Index"]<-SIndexT1_3

```

