---
title: "Analysis Combined Cleaned"
author: "Gustavo Reyes"
date: "1/21/2021"
output: html_document
---


```{r}

#Setting Working Directory-------------------------------------
#setwd("C:/Users/gareyes3/Documents/GitHub/Share-Table-QMRA/R") 
setwd("G:/Share Table QMRA/Share-Table-QMRA/R")
```

```{r}
#Opening Libary and Inputs-------------------------------------
source("Util_Library.R")
source("Functions_Full_Analysis.R")
```


#SHARE TABLE ON, No Interventions
```{r}
#Inputs and Source Files-------------------------------------


#Inputs
source("New_StudentLoop.R")
source("Input_Static.R")
source("Input_Functions.R")
source("Util_DFFunctions.R")
source("Util_DFWeekCreation.R")
source("Util_Counter&Lists.R")
#Functions
source("Util_Functions.R")
source("Util_CCFunctions2.R")
source("Util_VisualFunctions.R")

```

```{r warning=TRUE}
#Running Loop First:-------------------------------------
start_time<-Sys.time()
source("Main_Loops2.R")
```

```{r}
#Summary DFs for Future-------------------------------------

#Creating Data Frame of Consumed Items for all the products
#Copy of Compiled Data Frame
Individual_Analysis_Fr_CopON<-bind_rows(List_Sens_Fr)
Contaminations_ON<-Vector_Contaminations_In

#Data Frame without repeats and Consumed Items
ST_ON_Analysis<-Func_Asys_MainDF(SummaryList = List_Sens_Fr,FoodType = "Fruit")

```

#SHARE TABLE OFF, No Interventions


```{r}
#Inputs and Source Files-------------------------------------



#Inputs
source("New_StudentLoop.R")
source("Input_Static.R")
source("Input_Functions.R")
source("Util_DFFunctions.R")
source("Util_DFWeekCreation.R")
source("Util_Counter&Lists.R")
#Functions
source("Util_Functions.R")
source("Util_CCFunctions2.R")
source("Util_VisualFunctions.R")

#Share Table Toggle 
  
  #Include Share Table:
  Share_Table_YN<-0
  #NOTE: Turn off Re-Sharing and -ST to reservice too (next section)

# Re-Sharing, Re-Service 

  #Share Table to Service line after every Day # note turn in 1 if ST on
  STtoReservice_YN<-0
  #Re-Sharing of Share table items after every service # note turn in 1 is ST on
  Resharing_YN<-0

```

```{r warning=TRUE}
#Running Loop First:-------------------------------------
start_time<-Sys.time()
source("Main_Loops2.R")
```

```{r}
#Summary DFs for Future.------------------------------------- 

#Creating Data Frame of Consumed Items for all the products
#Copy of Compiled Data Frame
Individual_Analysis_Fr_CopOFF<-bind_rows(List_Sens_Fr)
Contaminations_OFF<-Vector_Contaminations_In

#Data Frame without repeats and Consumed Items
ST_OFF_Analysis<-Func_Asys_MainDF(SummaryList = List_Sens_Fr,FoodType = "Fruit")

```

#ST ON Wash ON, Wrapp OFF
```{r}
#Inputs and Source Files-------------------------------------

start_time<-Sys.time()

#Inputs
source("Input_Static.R")
source("Input_Functions.R")
source("Util_DFFunctions.R")
source("Util_DFWeekCreation.R")
source("Util_Counter&Lists.R")
#Functions
source("Util_Functions.R")
source("Util_CCFunctions2.R")
source("Util_VisualFunctions.R")

#Changing Inputs for Washing on, Wraaping off. 
  #Washing Between Services
  Wash_Between_Services<-0
  #Wash Selection Table Fruit
  Wash_Selection_YN_Fr<-1
  #Wash Share Table Items
  Wash_ST_YN_Fr<-1
  
#Changing Wrapping off:
  #Wrapping Apples
  Wrapping_Apples<-0
```

```{r warning=TRUE}
#Running Loop First:-------------------------------------
start_time<-Sys.time()
source("Main_Loops2.R")
```

```{r}
#Summary DFs for Future. -------------------------------------

#Creating Data Frame of Consumed Items for all the products
#Copy of Compiled Data Frame
Individual_Analysis_Fr_CopONWash<-bind_rows(List_Sens_Fr)
Contaminations_ONWash<-Vector_Contaminations_In

#Data Frame without repeats and Consumed Items
ST_ONWash_Analysis<-Func_Asys_MainDF(SummaryList = List_Sens_Fr,FoodType = "Fruit")
```

#ST ON Wrapping ON

Scenario where wrapping is on and washing is off
```{r}
#Inputs and Source Files-------------------------------------

start_time<-Sys.time()

#Inputs
source("Input_Static.R")
source("Input_Functions.R")
source("Util_DFFunctions.R")
source("Util_DFWeekCreation.R")
source("Util_Counter&Lists.R")
#Functions
source("Util_Functions.R")
source("Util_CCFunctions2.R")
source("Util_VisualFunctions.R")

#Changing Inputs for Washing off, Wraaping on. 
  #Washing Between Services
  Wash_Between_Services<-0
  #Wash Selection Table Fruit
  Wash_Selection_YN_Fr<-0
  #Wash Share Table Items
  Wash_ST_YN_Fr<-0
  
#Changing Wrapping off:
  #Wrapping Apples
  Wrapping_Apples<-1
```

```{r}
#Running Loop again:-------------------------------------
source("Main_Loops2.R")
```

```{r}
#Summary DFs for Future. 

#Creating Data Frame of Consumed Items for all the products
#Copy of Compiled Data Frame
Individual_Analysis_Fr_CopONWr<-bind_rows(List_Sens_Fr)
Contaminations_ONWr<-Vector_Contaminations_In

#Data Frame without repeats and Consumed Items
ST_ONWr_Analysis<-Func_Asys_MainDF(SummaryList = List_Sens_Fr,FoodType = "Fruit")
```

#ST OFF Wash ON, Wrapp OFF
```{r}
#Inputs and Source Files-------------------------------------

start_time<-Sys.time()

#Inputs
source("Input_Static.R")
source("Input_Functions.R")
source("Util_DFFunctions.R")
source("Util_DFWeekCreation.R")
source("Util_Counter&Lists.R")
#Functions
source("Util_Functions.R")
source("Util_CCFunctions2.R")
source("Util_VisualFunctions.R")

#Share Table Toggle 
  
  #Include Share Table:
  Share_Table_YN<-0
  #NOTE: Turn off Re-Sharing and -ST to reservice too (next section)

# Re-Sharing, Re-Service 

  #Share Table to Service line after every Day # note turn in 1 if ST on
  STtoReservice_YN<-0
  #Re-Sharing of Share table items after every service # note turn in 1 is ST on
  Resharing_YN<-0

#Changing Inputs for Washing on, Wraaping off. 
  #Washing Between Services
  Wash_Between_Services<-0
  #Wash Selection Table Fruit
  Wash_Selection_YN_Fr<-1
  #Wash Share Table Items
  Wash_ST_YN_Fr<-1
  
#Changing Wrapping off:
  #Wrapping Apples
  Wrapping_Apples<-0
```

```{r warning=TRUE}
#Running Loop First:-------------------------------------
start_time<-Sys.time()
source("Main_Loops2.R")
```

```{r}
#Summary DFs for Future.------------------------------------- 

#Creating Data Frame of Consumed Items for all the products
#Copy of Compiled Data Frame
Individual_Analysis_Fr_CopOFFWash<-bind_rows(List_Sens_Fr)
Contaminations_OFFWash<-Vector_Contaminations_In

#Data Frame without repeats and Consumed Items
ST_OFFWash_Analysis<-Func_Asys_MainDF(SummaryList = List_Sens_Fr,FoodType = "Fruit")
```


#ST OFF Wrapping ON

```{r}
#Inputs and Source Files-------------------------------------
# Source Files 
start_time<-Sys.time()

#Inputs
source("Input_Static.R")
source("Input_Functions.R")
source("Util_DFFunctions.R")
source("Util_DFWeekCreation.R")
source("Util_Counter&Lists.R")
#Functions
source("Util_Functions.R")
source("Util_CCFunctions2.R")
source("Util_VisualFunctions.R")

#Share Table Toggle 
  
  #Include Share Table:
  Share_Table_YN<-0
  #NOTE: Turn off Re-Sharing and -ST to reservice too (next section)

# Re-Sharing, Re-Service 

  #Share Table to Service line after every Day # note turn in 1 if ST on
  STtoReservice_YN<-0
  #Re-Sharing of Share table items after every service # note turn in 1 is ST on
  Resharing_YN<-0

#Changing Inputs for Washing off, Wraaping on. 
  #Washing Between Services
  Wash_Between_Services<-0
  #Wash Selection Table Fruit
  Wash_Selection_YN_Fr<-0
  #Wash Share Table Items
  Wash_ST_YN_Fr<-0
  
#Changing Wrapping off:
  #Wrapping Apples
  Wrapping_Apples<-1
```

```{r}
#Running Loop again:-------------------------------------
source("Main_Loops2.R")
```

```{r}
#Summary DFs for Future.------------------------------------- 

#Creating Data Frame of Consumed Items for all the products
#Copy of Compiled Data Frame
Individual_Analysis_Fr_CopOFFWr<-bind_rows(List_Sens_Fr)
Contaminations_OFFWr<-Vector_Contaminations_In

#Data Frame without repeats and Consumed Items
ST_OFFWr_Analysis<-Func_Asys_MainDF(SummaryList = List_Sens_Fr,FoodType = "Fruit")
```


#ST ON Exclusion Ill ON

```{r}
#Inputs and Source Files-------------------------------------


#Inputs
source("New_StudentLoop.R")
source("Input_Static.R")
source("Input_Functions.R")
source("Util_DFFunctions.R")
source("Util_DFWeekCreation.R")
source("Util_Counter&Lists.R")
#Functions
source("Util_Functions.R")
source("Util_CCFunctions2.R")
source("Util_VisualFunctions.R")

Ill_Avoid_ST<-1

```

```{r warning=TRUE}
#Running Loop First:-------------------------------------
start_time<-Sys.time()
source("Main_Loops2.R")
```

```{r}
#Summary DFs for Future-------------------------------------

#Creating Data Frame of Consumed Items for all the products
#Copy of Compiled Data Frame
Individual_Analysis_Fr_CopExc<-bind_rows(List_Sens_Fr)
Contaminations_Exc<-Vector_Contaminations_In

#Data Frame without repeats and Consumed Items
ST_Exc_Analysis<-Func_Asys_MainDF(SummaryList = List_Sens_Fr,FoodType = "Fruit")
```


#Additional Foood Waste Analysis: 

#1 scenarios, with no share table items to service line

#SHARE TABLE ON, ST to Reservice<-0


```{r}
#Inputs and Source Files-------------------------------------



#Inputs
source("New_StudentLoop.R")
source("Input_Static.R")
source("Input_Functions.R")
source("Util_DFFunctions.R")
source("Util_DFWeekCreation.R")
source("Util_Counter&Lists.R")
#Functions
source("Util_Functions.R")
source("Util_CCFunctions2.R")
source("Util_VisualFunctions.R")

STtoReservice_YN<-0

```

```{r warning=TRUE}
#Running Loop First:-------------------------------------
start_time<-Sys.time()
source("Main_Loops2.R")
```

```{r}
#Summary DFs for Future.------------------------------------- 

#Creating Data Frame of Consumed Items for all the products
Individual_Analysis_Fr_CopSTClosed<-bind_rows(List_Sens_Fr)
#Copy of Compiled Data Frame
Individual_Analysis_Fr_STClosed<-bind_rows(List_Sens_Fr)

#Data Frame without repeats and Consumed Items
ST_STClosed_Analysis<-Func_Asys_MainDF(SummaryList = List_Sens_Fr,FoodType = "Fruit")
```


#Dose Response ST ON

```{r}
#ST ON-------------------------------------
ST_ON_Analysis_Copy<-ST_ON_Analysis
#ST_ON_Analysis<-ST_ON_Analysis_Copy
ST_ON_Analysis<-Func_Asys_ContbyStudent(ST_ON_Analysis)
#Drop NAs
ST_ON_Analysis<- ST_ON_Analysis[!is.na(ST_ON_Analysis$Contamination), ]

#Analysis For weekly Dose Response ON

OutputsDRON<-Func_DR_Main(AnalysisDF = ST_ON_Analysis, Reps_DR = 100)
df_inf_Week_ON<-OutputsDRON$df_inf_Week
df_ill_Week_ON<-OutputsDRON$df_ill_Week

```

#Dose Response ST OFF
```{r}
#ST OFF-------------------------------------
ST_OFF_Analysis_Copy<-ST_OFF_Analysis
#ST_OFF_Analysis<-ST_OFF_Analysis_Copy
ST_OFF_Analysis<-Func_Asys_ContbyStudent(ST_OFF_Analysis)
ST_OFF_Analysis<- ST_OFF_Analysis[!is.na(ST_OFF_Analysis$Contamination), ]

#Analysis For weekly Dose Response ON

OutputsDROFF<-Func_DR_Main(AnalysisDF = ST_OFF_Analysis, Reps_DR = 100)
df_inf_Week_OFF<-OutputsDROFF$df_inf_Week
df_ill_Week_OFF<-OutputsDROFF$df_ill_Week

```

#Dose Response ST ON Wash ON
```{r}
#ST ON Wash ONF-------------------------------------
ST_ONWash_Analysis_Copy<-ST_ONWash_Analysis
ST_ONWash_Analysis<-Func_Asys_ContbyStudent(ST_ONWash_Analysis)
#Drop NAs
ST_ONWash_Analysis<- ST_ONWash_Analysis[!is.na(ST_ONWash_Analysis$Contamination), ]


#Analysis For weekly Dose Response ON

OutputsDRONWash<-Func_DR_Main(AnalysisDF = ST_ONWash_Analysis, Reps_DR = 100)
df_inf_Week_ONWash<-OutputsDRONWash$df_inf_Week
df_ill_Week_ONWash<-OutputsDRONWash$df_ill_Week

```

#Dose Response ST ON Wrapp ON
```{r}
#ST ON Wrapp ON-------------------------------------
ST_ONWr_Analysis_Copy<-ST_ONWr_Analysis
ST_ONWr_Analysis<-Func_Asys_ContbyStudent(ST_ONWr_Analysis)
#Drop NAs
ST_ONWr_Analysis<- ST_ONWr_Analysis[!is.na(ST_ONWr_Analysis$Contamination), ]

#Analysis For weekly Dose Response ON

OutputsDRONWr<-Func_DR_Main(AnalysisDF = ST_ONWr_Analysis, Reps_DR = 100)
df_inf_Week_ONWr<-OutputsDRONWr$df_inf_Week
df_ill_Week_ONWr<-OutputsDRONWr$df_ill_Week

```

#Dose Response ST OFF Wash ON
```{r}
#ST ST OFF Wash ON-------------------------------------
ST_OFFWash_Analysis_Copy<-ST_OFFWash_Analysis
ST_OFFWash_Analysis<-Func_Asys_ContbyStudent(ST_OFFWash_Analysis)
#Drop NAs
ST_OFFWash_Analysis<- ST_OFFWash_Analysis[!is.na(ST_OFFWash_Analysis$Contamination), ]

#Analysis For weekly Dose Response ON

OutputsDROFFWash<-Func_DR_Main(AnalysisDF = ST_OFFWash_Analysis, Reps_DR = 100)
df_inf_Week_OFFWash<-OutputsDROFFWash$df_inf_Week
df_ill_Week_OFFWash<-OutputsDROFFWash$df_ill_Week

```

#Dose Response ST OFF Wrapp ON
```{r}
#ST OFF Wrapp ONF-------------------------------------
ST_OFFWr_Analysis_Copy<-ST_OFFWr_Analysis
ST_OFFWr_Analysis<-Func_Asys_ContbyStudent(ST_OFFWr_Analysis)
#Drop NAs
ST_OFFWr_Analysis<- ST_OFFWr_Analysis[!is.na(ST_OFFWr_Analysis$Contamination), ]

#Analysis For weekly Dose Response ON

OutputsDROFFWr<-Func_DR_Main(AnalysisDF = ST_OFFWr_Analysis, Reps_DR = 100)
df_inf_Week_OFFWr<-OutputsDROFFWr$df_inf_Week
df_ill_Week_OFFWr<-OutputsDROFFWr$df_ill_Week

```


#Dose Response ST ON Exc ON
```{r}
#ST OFF Wrapp ONF-------------------------------------
ST_Exc_Analysis_Copy<-ST_Exc_Analysis
ST_Exc_Analysis<-Func_Asys_ContbyStudent(ST_Exc_Analysis)
#Drop NAs
ST_Exc_Analysis<- ST_Exc_Analysis[!is.na(ST_Exc_Analysis$Contamination), ]

#Analysis For weekly Dose Response ON

OutputsDRExc<-Func_DR_Main(AnalysisDF = ST_Exc_Analysis, Reps_DR = 100)
df_inf_Week_Exc<-OutputsDRExc$df_inf_Week
df_ill_Week_Exc<-OutputsDRExc$df_ill_Week

```


#Dose Response STClosed
```{r}
#ST OFF Wrapp ONF-------------------------------------
ST_STClosed_Analysis_Copy<-ST_STClosed_Analysis
ST_STClosed_Analysis<-Func_Asys_ContbyStudent(ST_STClosed_Analysis)
#Drop NAs
ST_STClosed_Analysis<- ST_STClosed_Analysis[!is.na(ST_STClosed_Analysis$Contamination), ]

#Analysis For weekly Dose Response ON

OutputsDRSTClosed<-Func_DR_Main(AnalysisDF = ST_STClosed_Analysis, Reps_DR = 100)
df_inf_Week_STClosed<-OutputsDRSTClosed$df_inf_Week
df_ill_Week_STClosed<-OutputsDRSTClosed$df_ill_Week

```



#Boxplot Data for All scenarios

```{r}
#ST ON
df_ill_Week_ON_Box_Prev<-Func_DF_Prevalence(AnalysisDFCop = ST_ON_Analysis_Copy, df_Ill_Week = df_ill_Week_ON,Intervention = "STON")

#ST OFF
df_ill_Week_OFF_Box_Prev<-Func_DF_Prevalence(AnalysisDFCop = ST_OFF_Analysis_Copy, df_Ill_Week = df_ill_Week_OFF,Intervention = "STOFF")

#ST ONWash
df_ill_Week_ONWash_Box_Prev<-Func_DF_Prevalence(AnalysisDFCop = ST_ONWash_Analysis_Copy, df_Ill_Week = df_ill_Week_ONWash,Intervention = "ONwash")

#ST ONWr
df_ill_Week_ONWr_Box_Prev<-Func_DF_Prevalence(AnalysisDFCop = ST_ONWr_Analysis_Copy, df_Ill_Week = df_ill_Week_ONWr,Intervention = "ONWr")

#ST OFFWash
df_ill_Week_OFFWash_Box_Prev<-Func_DF_Prevalence(AnalysisDFCop = ST_OFFWash_Analysis_Copy, df_Ill_Week = df_ill_Week_OFFWash,Intervention = "OFFWash")

#ST OFFWr
df_ill_Week_OFFWr_Box_Prev<-Func_DF_Prevalence(AnalysisDFCop = ST_OFFWr_Analysis_Copy, df_Ill_Week = df_ill_Week_OFFWr,Intervention = "OFFWr")

#ST Exc
df_ill_Week_Exc_Box_Prev<-Func_DF_Prevalence(AnalysisDFCop = ST_Exc_Analysis_Copy, df_Ill_Week = df_ill_Week_Exc,Intervention = "Exc")

#ST ST Closed
df_ill_Week_STClosed_Box_Prev<-Func_DF_Prevalence(AnalysisDFCop = ST_STClosed_Analysis_Copy, df_Ill_Week = df_ill_Week_STClosed,Intervention = "XSTClosed")

```
#Boxplot Together
```{r}
#Boxplot Together

df_ill_Week_Tog_Box<-bind_rows(df_ill_Week_ON_Box_Prev,df_ill_Week_OFF_Box_Prev,df_ill_Week_ONWash_Box_Prev,df_ill_Week_ONWr_Box_Prev,df_ill_Week_OFFWash_Box_Prev,df_ill_Week_OFFWr_Box_Prev,df_ill_Week_Exc_Box_Prev,df_ill_Week_STClosed_Box_Prev)

Ill_Prev_Comb<-ggplot(df_ill_Week_Tog_Box, aes(x = variable, y = Prev, fill=Int)) + 
  geom_boxplot() + 
  theme_bw()+
  ylab("Prevalence of Ill Students")+
  xlab("Week #") +
  ggtitle("ST Status: Compaison Weekly Dose Response Distribution: Prevalence Ill Students")+ 
  theme(plot.title = element_text(hjust = 0.5))+
  labs(fill = "Interventions")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

ggsave(filename = "Ill_Prev_Comb3.png", path = "Dose Response",width = 40,height = 10,)
print(Ill_Prev_Comb)
```

#Consumption Locations
```{r}
ST_Comb_Analysis_Con<-Func_DF_Locations_1()

Food_sec<-ggplot(data =ST_Comb_Analysis_Con, aes(x = Type,fill=Location)  )+
  geom_bar()+
  geom_text(stat = "count",aes(label=..count..),position = position_stack(vjust = .5))+
  xlab("Number of Fruit Items")+
  ylab("Intervention")+
  ggtitle("Share Table Interventions: Items Consumed vs Discarded")+ 
  theme(plot.title = element_text(hjust = 0.5))

outputsLocations<-Func_DF_Locations()
Vector_Total_Items<-outputsLocations$Vector_Total_Items
Vector_Total_Item_Con<-outputsLocations$Vector_Total_Item_Con
Vector_Total_Item_Dis<-outputsLocations$Vector_Total_Item_Dis

ggsave(filename = "Food_sec3.png", path = "Dose Response",width = 8,height = 6,)
print(Food_sec)

```


#Histograms for Exposure
```{r}
ST_ON_Analysis_Log<-Func_DF_Histogram_Log(AnalysisDF = ST_ON_Analysis,Intervention = "ON")
ST_OFF_Analysis_Log<-Func_DF_Histogram_Log(AnalysisDF = ST_OFF_Analysis,Intervention = "OFF")
ST_ONWash_Analysis_Log<-Func_DF_Histogram_Log(AnalysisDF = ST_ONWash_Analysis,Intervention = "ONWash")
ST_ONWr_Analysis_Log<-Func_DF_Histogram_Log(AnalysisDF = ST_ONWr_Analysis,Intervention = "ONWr")
ST_OFFWash_Analysis_Log<-Func_DF_Histogram_Log(AnalysisDF = ST_OFFWash_Analysis,Intervention = "OFFWash")
ST_OFFWr_Analysis_Log<-Func_DF_Histogram_Log(AnalysisDF = ST_OFFWr_Analysis,Intervention = "OFFWr")
ST_Exc_Analysis_Log<-Func_DF_Histogram_Log(AnalysisDF = ST_Exc_Analysis,Intervention = "XExc")
ST_STClosed_Analysis_Log<-Func_DF_Histogram_Log(AnalysisDF = ST_STClosed_Analysis,Intervention = "XSTClosed")



ST_Comb_Analysis_Log<-bind_rows(ST_ON_Analysis_Log,ST_OFF_Analysis_Log,ST_ONWash_Analysis_Log,ST_ONWr_Analysis_Log,ST_OFFWash_Analysis_Log,ST_OFFWr_Analysis_Log,ST_Exc_Analysis_Log,ST_STClosed_Analysis_Log)

Histolabels<-c("OFF" = "Baseline: ST OFF, No Intervention", 
                "OFFWash"  = "ST OFF, Wash ON", 
                "OFFWr" ="ST OFF, Wrapping ON", 
                "ON"="ST ON, No Intervention", 
                "ONWash" =  "ST ON, Wash ON",
                "ONWr" =  "ST ON, Wrapping ON",
                "XExc" = "ST ON, 50% Exclusion ",
               "XSTClosed" = "Re-Service OFF"
               )

Wrapped_Histograms<-ggplot(data = ST_Comb_Analysis_Log,aes(x=Log))+
  geom_histogram(colour="black", alpha=.2,bins =10,boundary = -.001)+
  facet_wrap( ~OnOff ,labeller = as_labeller(Histolabels))+
  scale_x_continuous( )+
  xlab("Contamination log GEC/Item")+
  ylab("Number of Students")+
  ggtitle("Share Table Interventions: Contamination distribution Consumed by Students")+ 
  theme(plot.title = element_text(hjust = 0.5))+
  stat_bin(aes(y=..count.., label=..count..), geom="text", vjust=-.2,bins=10, boundary = -.001,size=3)

ggsave(filename = "Wrapped_Histograms3.png", path = "Dose Response",width = 10,height = 10,)
print(Wrapped_Histograms)



```

```{r}
tipsON<-Func_DF_Barplot_Log(ST_Analysis_Log = ST_ON_Analysis_Log, Intervention = "ON")
tipsOFF<-Func_DF_Barplot_Log(ST_Analysis_Log = ST_OFF_Analysis_Log,Intervention = "OFF")
tipsONWash<-Func_DF_Barplot_Log(ST_Analysis_Log = ST_ONWash_Analysis_Log,Intervention = "ONWash")
tipsONWr<-Func_DF_Barplot_Log(ST_Analysis_Log = ST_ONWr_Analysis_Log,Intervention = "ONWr")
tipsOFFWash<-Func_DF_Barplot_Log(ST_Analysis_Log = ST_OFFWash_Analysis_Log,Intervention = "OFFWash")
tipsOFFWr<-Func_DF_Barplot_Log(ST_Analysis_Log = ST_OFFWr_Analysis_Log,Intervention = "OFFWr")
tipsExc<-Func_DF_Barplot_Log(ST_Analysis_Log = ST_Exc_Analysis_Log,Intervention = "XExc")
tipsSTClosed<-Func_DF_Barplot_Log(ST_Analysis_Log = ST_STClosed_Analysis_Log,Intervention = "XSTClosed")


tips4<-bind_rows(tipsON,tipsOFF,tipsONWash,tipsONWr,tipsOFFWash, tipsOFFWr,tipsExc,tipsSTClosed)

barchart_Expos<-ggplot(data =tips4, aes(x = OnOff,y=perc, fill=factor(Category, levels=c("0","<0 - 99","100 - 999",">=1000"))))+
  geom_col(width = .7)+
  geom_text_repel(aes(x = OnOff, 
                      y = perc, 
                      label = paste(round(perc*100,2),"%")),nudge_y = .1, nudge_x = .25, direction = "x")+
  geom_text_repel(aes(x = OnOff, 
                      y = perc, 
                      label = n),nudge_x = -.25,nudge_y = .1, direction = "x")+
  labs(fill = "Category")+
  scale_x_discrete()+
  coord_flip()+
  xlab(label = "Share Table Status")+
  ylab(label = "")+
    ggtitle("Composition on Exposure of Individual Students (%)")+ 
  theme(plot.title = element_text(hjust = 0.5))

ggsave(filename = "barchart_Expos_3.png", path = "Dose Response",width = 10,height = 6,)
print(barchart_Expos)

colors_11<-c("dodgerblue4","dodgerblue3","lightskyblue1","palegreen4","palegreen3","darkseagreen1", "Orange", "Red")

Barchart_Expos2<-ggplot(data =tips4, aes(fill=OnOff,y=perc, x=factor(Category, levels=c("0","<0 - 99","100 - 999",">=1000"))))+
  geom_bar(position="dodge", stat="identity")+
  geom_text(aes(label=paste(round(perc*100,1),"%")), position=position_dodge(width=0.9), vjust=0.25,hjust = .5 ,size = 3.5, angle = 90)+
  xlab(label = "Exposure Levels: GEC NoV Consumed")+
  ylab(label = "Percentage")+
  ggtitle("Composition on Exposure of Individual Students (%)")+ 
  theme(plot.title = element_text(hjust = 0.5))+
  labs(fill = "Intervention")+
  scale_fill_manual(values = colors_11, labels = c("Baseline: ST OFF, No Intervention", 
                                                        "ST OFF, Wash ON",
                                                        "ST OFF, Wrapping ON",
                                                        "ST ON, No Interventions",
                                                        "ST ON, Wash ON",
                                                        "ST ON, Wrapping ON",
                                                        "ST ON, Ill Exclusion",
                                                        "Re-Service Off"))

ggsave(filename = "Barchart_Expos2_3.png", path = "Dose Response",width = 8,height = 6,)
print(Barchart_Expos2)





```

```{r}

List_Summary_Table<-list(ST_ON_Analysis,ST_OFF_Analysis,ST_ONWash_Analysis,ST_ONWr_Analysis,ST_OFFWash_Analysis,ST_OFFWr_Analysis,ST_Exc_Analysis, ST_STClosed_Analysis)

  Treatment_Names<-c("ON", "OFF", "ONWash","ONWr", "OFFWash","OFFWr", "XExc", "XSTClosed")

  NStudentsConsumed<-sapply(List_Summary_Table, nrow)

List_Summary_Table_Ill<-list(df_ill_Week_ON_Box_Prev,df_ill_Week_OFF_Box_Prev,df_ill_Week_ONWash_Box_Prev,df_ill_Week_ONWr_Box_Prev,df_ill_Week_OFFWash_Box_Prev,df_ill_Week_OFFWr_Box_Prev,df_ill_Week_Exc_Box_Prev, df_ill_Week_STClosed_Box_Prev)

List_Summary_Table_Ill_Col<-lapply(List_Summary_Table_Ill,"[[","Prev")
  
  MeanPRevalneces<-sapply(X =List_Summary_Table_Ill_Col,FUN = mean )
  MeadianPrevalences<-sapply(X =List_Summary_Table_Ill_Col,FUN = median )
  Prevs975<-sapply(X =List_Summary_Table_Ill_Col,FUN = quantile,.975  )
  Prevs025<-sapply(X =List_Summary_Table_Ill_Col,FUN = quantile,.025  )

List_Percentages_Dist<-list(tipsON,tipsOFF,tipsONWash,tipsONWr,tipsOFFWash, tipsOFFWr,tipsExc, tipsSTClosed)
  ZerosL<-unlist(sapply(List_Percentages_Dist,function(x) x[4,3]))
  ZeroNine<-unlist(sapply(List_Percentages_Dist,function(x) x[3,3]))
  Nine_3Nine<-unlist(sapply(List_Percentages_Dist,function(x) x[2,3]))
  ThousandsL<-unlist(sapply(List_Percentages_Dist,function(x) x[1,3]))
  
  #Creation of Data Frame
  
  Summary_Comparison_Treatments<-data.frame(
  "Treatment" = c(1:8),
  "Treatment Desc" = Treatment_Names
)
  
  Summary_Comparison_Treatments<-data.frame(
  "Treatment" = c(1:8),
  "Treatment Desc" = Treatment_Names,
  "NWeeks" = Sens_Iterations,
  "Participating Students" = N_Iterations*Service_No* Food_Days*Sens_Iterations,
  "NStudentCosumedFood" = NStudentsConsumed,
  #"ConsumptionRate"=Summary_Comparison_Treatments$NStudentCosumedFood/Summary_Comparison_Treatments$Participating.Students*100,
  "TotalFruitSystem"= Vector_Total_Items,
  "TotalFruitConsumed"=Vector_Total_Item_Con,
  "TotalFruitDiscarded"=Vector_Total_Item_Dis,
  #"PercentConsumed"=Summary_Comparison_Treatments$TotalFruitConsumed/Summary_Comparison_Treatments$TotalFruitSystem,
  #"PercentDiscarded"=Summary_Comparison_Treatments$TotalFruitDiscarded/Summary_Comparison_Treatments$TotalFruitSystem,
  "0" = ZerosL*100 ,
  ">0" = ZeroNine*100,
  ">100"=Nine_3Nine*100,
  ">1000"= ThousandsL*100,
  "Mean Prevalence Ill" = MeanPRevalneces*100,
  "MedianPrev"= MeadianPrevalences,
  "Top 97.5 Ill"=Prevs975*100,
  "Bot 025 Ill"=Prevs025*100,
  stringsAsFactors = FALSE
  )
  
  
  Summary_Comparison_Treatments<-data.frame(
  "Treatment" = c(1:8),
  "Treatment Desc" = Treatment_Names,
  "NWeeks" = Sens_Iterations,
  "Participating Students" = N_Iterations*Service_No* Food_Days*Sens_Iterations,
  "NStudentCosumedFood" = NStudentsConsumed,
  "ConsumptionRate"=Summary_Comparison_Treatments$NStudentCosumedFood/Summary_Comparison_Treatments$Participating.Students*100,
  "TotalFruitSystem"= Vector_Total_Items,
  "TotalFruitConsumed"=Vector_Total_Item_Con,
  "TotalFruitDiscarded"=Vector_Total_Item_Dis,
  "PercentConsumed"=Summary_Comparison_Treatments$TotalFruitConsumed/Summary_Comparison_Treatments$TotalFruitSystem*100,
  "PercentDiscarded"=Summary_Comparison_Treatments$TotalFruitDiscarded/Summary_Comparison_Treatments$TotalFruitSystem*100,
  "0" = ZerosL*100 ,
  ">0" = ZeroNine*100,
  ">100"=Nine_3Nine*100,
  ">1000"= ThousandsL*100,
  "Mean Prevalence Ill" = MeanPRevalneces*100,
  "MedianPrev"= MeadianPrevalences,
  "Top 97.5 Ill"=Prevs975*100,
  "Bot 025 Ill"=Prevs025*100,
  
  stringsAsFactors = FALSE
  )
  
  write.csv(x =  Summary_Comparison_Treatments,"G:/Share Table QMRA/Share-Table-QMRA/R/Dose Response/SummaryComparison.csv", row.names = FALSE )
  #write.csv(x =  Summary_Comparison_Treatments,"C:/Users/gareyes3/Documents/GitHub/Share-Table-QMRA/R/Dose Response/SummaryComparison.csv", row.names = FALSE )


  

  
```


```{r}
binded_prevalences<-bind_rows(df_ill_Week_ON_Box_Prev,df_ill_Week_OFF_Box_Prev,df_ill_Week_ONWash_Box_Prev,df_ill_Week_ONWr_Box_Prev,df_ill_Week_OFFWash_Box_Prev,df_ill_Week_OFFWr_Box_Prev,df_ill_Week_Exc_Box_Prev, df_ill_Week_STClosed_Box_Prev)

binded_prevalences$Prev<-binded_prevalences$Pre*100


colors_12<-c('STOFF'="dodgerblue4",'OFFWash' ="dodgerblue3",'OFFWr'="dodgerblue1",'STON' ="darkseagreen","ONwash" ="palegreen3","ONWr"="palegreen2","Exc" = "Orange", "XSTClosed" = "Red" )

Histolabels2<-c("STOFF" = "Baseline: ST OFF, No Intervention", 
                "OFFWash"  = "ST OFF, Wash ON", 
                "OFFWr" ="ST OFF, Wrapping ON", 
                "STON"="ST ON, No Intervention", 
                "ONwash" =  "ST ON, Wash ON",
                "ONWr" =  "ST ON, Wrapping ON",
                "Exc"=  "STON, Ill Exclusion",
                "XSTClosed" = "Re-service off"
               )

Dose_Hist_Stacked<-ggplot(data = binded_prevalences, mapping = aes(x= Prev, fill=factor(Int,c('STOFF','OFFWash', 'OFFWr',  'STON', 'ONwash',  'ONWr', 'Exc','XSTClosed') )))+
  geom_histogram(bins=15,boundary = .001,color= "black")+
  xlab(label = "Illness prevalence (%)")+
  ylab(label = "Observation Count")+
  ggtitle("Illness prevalence, comparing Interventions")+ 
  theme(plot.title = element_text(hjust = 0.5))+
  labs(fill = "Intervention")+
  scale_fill_manual(values = colors_11, labels = c("Baseline: ST OFF, No Intervention", 
                                                        "ST OFF, Wash ON",
                                                        "ST OFF, Wrapping ON",
                                                        "ST ON, No Interventions",
                                                        "ST ON, Wash ON",
                                                        "ST OFF, Wrapping ON",
                                                        "STON, Ill Exclusion",
                                                        "Re-service off" ))

ggsave(filename = "Dose_Hist_Stacked3.png", path = "Dose Response",width = 10,height = 6,)
print(Dose_Hist_Stacked)


Facet_DR_Hist<-ggplot(data = binded_prevalences, mapping = aes(x= Prev))+
  geom_histogram(bins=15,boundary = .001, color= "black")+
  facet_wrap(~factor(Int,c('STOFF','OFFWash', 'OFFWr',  'STON', 'ONwash',  'ONWr', 'Exc', 'XSTClosed')),  labeller = as_labeller(Histolabels2))+
  scale_fill_manual( values =  colors_12)+
  xlab(label = "Illness prevalence (%)")+
  ylab(label = "Observation Count")+
  ggtitle("Illness prevalence, comparing Interventions")+ 
  theme(plot.title = element_text(hjust = 0.5))+
  labs(fill = "Intervention")
  
  
ggsave(filename = "Facet_DR_Hist3.png", path = "Dose Response",width = 10,height = 10,)
print(Facet_DR_Hist)




binded_prevalences_Tail<-binded_prevalences[binded_prevalences$Prev>2,]

Tails_prev<-ggplot(data = binded_prevalences_Tail, mapping = aes(x= Prev, fill=factor(Int,c('STOFF','OFFWash', 'OFFWr',  'STON', 'ONwash',  'ONWr','Exc','XSTClosed') )))+
  geom_histogram(bins=10,color= "black")+
  xlab(label = "Illness prevalence (%)")+
  ylab(label = "Observation Count")+
  ggtitle("Illness prevalence, comparing Interventions")+ 
  theme(plot.title = element_text(hjust = 0.5))+
  labs(fill = "Intervention")+
  scale_fill_manual(values = colors_12, labels = c('STOFF'="Baseline: ST OFF, No Intervention", 
                                                     'OFFWash'= "ST OFF, Wash ON",
                                                      'OFFWr'="ST OFF, Wrapping ON",
                                                       'STON'= "ST ON, No Interventions",
                                                        'ONwash'="ST ON, Wash ON",
                                                        'ONWr'="ST OFF, Wrapping ON",
                                                        'Exc'="STON, Ill Exclusion",
                                                        "Re-service off"))

ggsave(filename = "Tails_prev3.png", path = "Dose Response",width = 10,height = 6,)
print(Tails_prev)


binded_prevalences_Tail3<-binded_prevalences[binded_prevalences$Prev>3,]

Tails_prev3<-ggplot(data = binded_prevalences_Tail3, mapping = aes(x= Prev, fill=factor(Int,c('STOFF','OFFWash', 'OFFWr',  'STON', 'ONwash',  'ONWr','Exc','XSTClosed') )))+
  geom_histogram(bins=10,color= "black")+
  xlab(label = "Illness prevalence (%)")+
  ylab(label = "Observation Count")+
  ggtitle("Illness prevalence, comparing Interventions")+ 
  theme(plot.title = element_text(hjust = 0.5))+
  labs(fill = "Intervention")+
  scale_fill_manual(values = colors_12, labels = c('STOFF'="Baseline: ST OFF, No Intervention", 
                                                     'OFFWash'= "ST OFF, Wash ON",
                                                      'OFFWr'="ST OFF, Wrapping ON",
                                                       'STON'= "ST ON, No Interventions",
                                                        'ONwash'="ST ON, Wash ON",
                                                        'ONWr'="ST OFF, Wrapping ON",
                                                        'Exc'="STON, Ill Exclusion",
                                                        "Re-service off"))

ggsave(plot = Tails_prev3,filename = "Tails_prev_3.png", path = "Dose Response",width = 10,height = 6,)
print(Tails_prev3)


VIolinPlot<-ggplot(data = binded_prevalences, mapping = aes(y= Prev, x=factor(Int,c('STOFF','OFFWash', 'OFFWr',  'STON', 'ONwash',  'ONWr','Exc','XSTClosed') ), fill=factor(Int,c('STOFF','OFFWash', 'OFFWr',  'STON', 'ONwash',  'ONWr','Exc','XSTClosed') )))+
  geom_violin()+
  geom_boxplot(width=0.1)+
  labs(fill = "Intervention")+
  xlab(label = "Intervention")+
  scale_fill_manual(values = colors_11, labels = c("Baseline: ST OFF, No Intervention", 
                                                   "ST OFF, Wash ON",
                                                   "ST OFF, Wrapping ON",
                                                   "ST ON, No Interventions",
                                                   "ST ON, Wash ON",
                                                   "ST OFF, Wrapping ON",
                                                   "STON, Ill Exclusion",
                                                   "Re-service off"))

ggsave(filename = "Violin3.png",path = "Dose Response",width = 10,height = 8,)

```




```{r}


ST_STClosed_Analysis_Con<-func_remove_repeats(Individual_Analysis_Fr_STClosed)
ST_STClosed_Analysis_Con$Type<-"Closed"


Combined_Closed_Analysis<-Func_DF_Locations_2()
```

```{r}
ggplot(data =Combined_Closed_Analysis, aes(x = Type,fill=Location)  )+
  geom_bar()+
  geom_text(stat = "count",aes(label=..count..),position = position_stack(vjust = .5))+
  xlab("Number of Fruit Items")+
  ylab("Intervention")+
  ggtitle("Share Table Interventions: Items Consumed vs Wasted")+ 
  theme(plot.title = element_text(hjust = 0.5))+
  scale_x_discrete(labels=c("Closed"="Re-Service Off",
                          "OFF" = "STOFF",
                          "ON"= "STON"))


ggsave(filename = "FoodSecFin3.png", path = "Dose Response",width = 10,height = 6,)

```

