---
title: "Main Model-Run once"
author: "Gustavo Reyes"
date: "12/10/2020"
output: html_document
---

```{r}

#Setting Working Directory-------------------------------------
#setwd("C:/Users/gareyes3/Documents/GitHub/Share-Table-QMRA/R") 
setwd("G:/Share Table QMRA/Share-Table-QMRA/R")
```

```{r}
#Opening Libary and Inputs-------------------------------------
source("Util_Library.R")
source("Functions_Full_Analysis.R")
```


#SHARE TABLE ON, No Interventions Main Model. 
```{r}
#Inputs and Source Files-------------------------------------


#Inputs
source("New_StudentLoop.R")
source("Input_Static.R")
source("Input_Functions.R")
source("Util_DFFunctions.R")
source("Util_DFWeekCreation.R")
source("Util_Counter&Lists.R")
#Functions
source("Util_Functions.R")
source("Util_CCFunctions2.R")
source("Util_VisualFunctions.R")

Wash_Bucket<-1
Pr_touch_Food_ST<-0


```

```{r warning=TRUE}
#Running Loop First:-------------------------------------
start_time<-Sys.time()
source("Main_Loops2.R")
```

```{r}
#Summary DFs for Future-------------------------------------
#Creating Data Frame of Consumed Items for all the products
#Copy of Compiled Data Frame
Individual_Analysis_Fr_Main<-bind_rows(List_Sens_Fr)
Contaminations_ON<-Vector_Contaminations_In

#Data Frame without repeats and Consumed Items
ST_Main_Analysis<-Func_Asys_MainDF(SummaryList = List_Sens_Fr,FoodType = "Fruit")


Individual_Analysis_Fr_CopON<-Individual_Analysis_Fr_CopON %>% 
    group_by(ID) %>% 
    filter(TotServices==max(TotServices))

Individual_Analysis_Fr_CopON %>% 
  group_by(Location) %>% 
  count(Location)
  
#Dose Response

#ST ON-------------------------------------
ST_Main_Analysis_Copy<-ST_Main_Analysis

#ST_ON_Analysis<-ST_ON_Analysis_Copy
ST_Main_Analysis<-Func_Asys_ContbyStudent(ST_Main_Analysis)


#Drop NAs
ST_Main_Analysis<- ST_Main_Analysis[!is.na(ST_Main_Analysis$Contamination), ]

#Analysis For weekly Dose Response ON

OutputsDRMain<-Func_DR_Main(AnalysisDF = ST_Main_Analysis, Reps_DR = 100)
df_inf_Week_Main<-OutputsDRMain$df_inf_Week
df_ill_Week_Main<-OutputsDRMain$df_ill_Week

#Prevalence

df_ill_Week_Main_Box_Prev<-Func_DF_Prevalence(AnalysisDFCop = ST_Main_Analysis_Copy, df_Ill_Week = df_ill_Week_Main,Intervention = "Main")

mean(df_ill_Week_Main_Box_Prev$Prev)

```

